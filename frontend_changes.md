# Frontend Changes for Kie.ai Migration

Чтобы фронтенд полностью соответствовал новому бэкенду и использовал все возможности Kie.ai, рекомендуется внести следующие изменения:

## 1. Обновление Model IDs
Бэкенд теперь поддерживает следующие модели. Рекомендуется обновить списки выбора:

- **Видео**:
  - `veo3_fast` (Google Veo 3.1 Fast) — быстро и дешево.
  - `veo3` (Google Veo 3.1 Quality) — высокое качество.
  - *Примечание: Старые ID `veo-3.1` маппятся автоматически, но лучше перейти на новые.*

- **Картинки**:
  - `google/nano-banana` — стандартная генерация.
  - `google/nano-banana-edit` — если пользователь загрузил картинку для редактирования (image-to-image).
  - `nano-banana-pro` — для генерации в высоком разрешении (нужно передавать `resolution: "4k"`).

- **Чат**:
  - `gemini-3-flash`
  - `gemini-3-pro`

## 2. Параметры генерации
- **Image**: Добавьте возможность выбора 4K. Для этого отправляйте в теле запроса `"resolution": "4k"` или `"is_4k": true`.
- **Video**: Теперь поддерживается `aspect_ratio` со значениями `"16:9"` или `"9:16"`.

## 3. Отображение цен
Цены на бэкенде теперь считаются в **RUB**. Если фронтенд отображает стоимость перед генерацией, обновите значения:
- Veo 3.1 Fast: ~65 RUB (в среднем за 5 сек).
- Nano Banana: ~25 RUB.
- Nano Banana Pro (4K): ~30 RUB.
- Gemini 3: Расчет по токенам (0.2 - 0.5 RUB за средний диалог).

## 5. Асинхронный режим (ВАЖНО)
Чтобы избежать тайм-аутов при генерации видео (которая может длиться до 1-2 минут), бэкенд переведен в **асинхронный режим**.

### Как теперь работает генерация (Video/Image):
1.  Фронтенд отправляет `POST /api/v1/videos/generate`.
2.  Бэкенд **мгновенно** возвращает ID задачи в БД:
    ```json
    {
      "id": 125,
      "status": "processing",
      "message": "Генерация начата"
    }
    ```
3.  Фронтенд должен запустить цикл опроса (polling) для этого ID.

### Новый эндпоинт статуса:
`GET /api/v1/history/:id`

**Пример логики на фронте:**
```javascript
// 1. Запуск
const startRes = await fetch('/api/v1/videos/generate', { ... });
const { id } = await startRes.json();

// 2. Опрос каждые 5 секунд
const poll = setInterval(async () => {
  const res = await fetch(`/api/v1/history/${id}`);
  const task = await res.json();
  
  if (task.status === 'success') {
    clearInterval(poll);
    showVideo(task.resultUrl); // Ссылка на Cloudflare R2
  } else if (task.status === 'failed' || task.status === 'error') {
    clearInterval(poll);
    showError();
  }
}, 5000);
```

Это гарантирует, что пользователь увидит результат, даже если вкладка была неактивна или соединение кратковременно прервалось.
